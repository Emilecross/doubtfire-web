<div class="stage-manager-container">

  <!-- <h3>Feedback Stages for {{taskDefinition?.abbreviation}}</h3> -->
  <!-- <button (click)="addClick()">Add Stage</button> -->

  <!-- <ul>
    <li *ngFor="let stage of taskDefinition.stages.currentValues">
      {{stage.title}} {{stage.order}}
    </li>
  </ul> -->

  <table mat-table [dataSource]="taskDefinition?.stages.currentValues" class="mat-elevation-z3">
    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef> Title </th>
      <td mat-cell *matCellDef="let stage">
        <div *ngIf="!editing(stage) else editTemplate" (click)="select(stage)">
          {{stage.title}}
        </div>
        <ng-template #editTemplate>
          <mat-form-field>
            <input type="text" matInput [(ngModel)]="stage.title">
          </mat-form-field>
        </ng-template>
      </td>
      <td mat-footer-cell *matFooterCellDef>
        <mat-form-field class="data-entry">
          <input type="text" matInput required [(ngModel)]="newStageData.title" placeholder="Title">
        </mat-form-field>
      </td>
    </ng-container>

    <ng-container matColumnDef="order">
      <th mat-header-cell *matHeaderCellDef> Order </th>
      <td mat-cell *matCellDef="let stage">
        <div *ngIf="!editing(stage) else editTemplate" (click)="select(stage)">
          {{stage.order}}
        </div>
        <ng-template #editTemplate>
          <mat-form-field>
            <input type="number" matInput [(ngModel)]="stage.order">
          </mat-form-field>
        </ng-template>
      </td>
      <td mat-footer-cell *matFooterCellDef>
      </td>
    </ng-container>

    <!-- Options Column -->
    <ng-container matColumnDef="options" stickyEnd>
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let stage">
        <div class="right" *ngIf="!editing(stage) else editTemplate">
          <button mat-icon-button (click)="edit(stage)" aria-label="edit stage">
            <mat-icon color="primary">edit</mat-icon>
          </button>
          <button mat-icon-button (click)="delete(stage)" aria-label="delete stage">
            <mat-icon color="warn">delete</mat-icon>
          </button>
        </div>
        <ng-template #editTemplate>
          <div class="edit-actions right">
            <span>
              <button mat-icon-button color="warn" (click)="cancelEdit()">
                <mat-icon>cancel</mat-icon>
              </button>
              <button mat-icon-button color="primary" (click)="saveEdits()">
                <mat-icon>save</mat-icon>
              </button>
            </span>
          </div>
        </ng-template>
      </td>
      <td mat-footer-cell *matFooterCellDef>
        <div class="edit-actions right">
          <button mat-icon-button (click)="addNewStage()" aria-label="add stage">
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columns"></tr>
    <tr mat-row [ngClass]="{'highlight': selected(row)}" *matRowDef="let row; columns: columns;"></tr>
    <tr [hidden]="isEditing" mat-footer-row *matFooterRowDef="columns"></tr>
  </table>

  <stage-editor [stage]="selectedStage" *ngIf="selectedStage"></stage-editor>
</div>
